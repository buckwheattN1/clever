{% extends 'main.html' %}
{% load attachments_tags %}
{% get_attachments_for order as attachments %}

{% block content %}

<div class="row">
<div class="col-sm-12">
  <div class="card">
    <div class="card-body">
      <div class="col-sm-12">
        <div class="col-sm-4 mt-3">
          {% if order.status == 1 %}
          
          {% endif %}
        <table class="table table-borderless table-sm text-start">
            <tbody>
              <tr>
                <td>Zamówienie nr:</td>
                <td>{{ order }}</td>
              </tr>
              <tr>
                <td>Data:</td>
                <td>{{ order.date }}</td>
              </tr>
              <tr>
                <td>Płatność:</td>
                {% if order.settlement == False %}
                <td>Nierozliczone</td>
                {% else %}
                <td>Rozliczone</td>
                {% endif %}
              </tr>
              <tr>
              <tr>
                <td>Status:</td>
                <td>{{ order.get_status_display }}</td>
              </tr>
              
                <td>Zamawiający:</td>
                <td>{{ order.customer }}</td>
              </tr>
              <tr>
                <td>Adres:</td>
                <td>{{ order.customer.address_line_1 }}, {{ order.customer.postcode }} {{ order.customer.town_city }}</td>
              </tr>
              <tr>
                <td>Tel:</td>
                <td>{{ order.customer.phone_number }}</td>
              </tr>
            </tbody>
        </table>
        </div>
        <table class="table table-success table-striped">
          <thead>
            <tr>
              <th scope="col">Materiał</th>
              <th scope="col">Usługi</th>
              <th scope="col">Ilość</th>
              <th scope="col">Cena(m2)</th>
              <th scope="col">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for ms in materialservices %}
            <tr>
              <td scope="col">{{ ms.material }}</td>
              <td scope="col">{{ ms.services }}</td>
              <td scope="col">{{ ms.area }}m2</td>
              <td scope="col">{{ ms.price }}pln</td>
              <td scope="col">{{ ms.total|floatformat:2 }}pln</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot class="dark">
            <tr>
              <td><a href="{% url 'getpdf' order.id %}" class="btn btn-danger btn-sm">Generuj PDF</a></td>
              <td>
                {% if order.status != 1 %}
                <a href="{% url 'detail-production' order.id %}" class="btn btn-warning btn-sm">Zobacz produkcję</a>
                {% elif order.status == 1 %}
                <a href="{% url 'create-production' order.id %}" class="btn btn-primary btn-sm float-en">Rozpocznij produkcję</a> 
                {% endif %}
              </td>
              <td>
                {% if order.status == 3 %}
                <a href="{% url 'detail-production' order.id %}" class="btn btn-success btn-sm">Rozlicz</a>
                {% endif %}
              </td>
              <td>Razem: </td>
              <td class="fw-bold"> {{ order.get_total|floatformat:2 }}pln</td>
            </tr>

          </tfoot>
          
        
        </table>
        

        <span>Object has {% attachments_count order %} attachments</span>
        {% if attachments %}
        <ul>
        {% for attachment in my_entry_attachments %}
            <li>
                <a href="{{ attachment.attachment_file.url }}">{{ attachment.filename }}</a>
                {% attachment_delete_link attachment %}
            </li>
        {% endfor %}
        </ul>
        {% endif %}
        
        {% attachment_form order %}
        
        {% if messages %}
        <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                {{ message }}
            </li>
        {% endfor %}
        </ul>
        {% endif %}

      </div>
   </div>
 </div>
</div>

</div>
{% endblock %}


